webpackJsonp([2],{VsFl:function(t,e){},hwUD:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o("4YfN"),i=o.n(n),a=o("9rMa"),s={data:function(){return{formdata:{name:"",alert_condition:"enter"},options:[{value:"enter",label:"进围栏报警"},{value:"leave",label:"出围栏报警"}]}},computed:i()({},Object(a.b)(["enclosureInfo","userInfo"])),created:function(){this.$route.query.gid&&(this.formdata.name=this.$route.query.name)},methods:{goback:function(){this.$router.go(-1)},sub:function(){var t=this;if(""==this.formdata.name)this.toast("围栏名称不能为空");else{this.Indicator.open({text:"请稍后...",spinnerType:"fading-circle"});var e=new Date,o=e.getMonth()+1,n=e.getDate();o<10&&(o="0"+(e.getMonth()+1)),n<10&&(n="0"+n);var i=e.getFullYear()+"-"+o+"-"+n,a=void 0;if(0==this.enclosureInfo.type)console.log(this.enclosureInfo.data[0].position[0]+","+this.enclosureInfo.data[0].position[1]),a={name:this.formdata.name,center:this.enclosureInfo.data[0].position[0]+","+this.enclosureInfo.data[0].position[1],radius:this.enclosureInfo.radius,enable:"true",repeat:"Mon,Tues,Wed,Thur,Fri,Sat,Sun",time:"00:00,11:59;13:00,23:59",desc:"测试围栏描述",alert_condition:this.formdata.alert_condition};else{var s=this.enclosureInfo.data,r="";s.forEach(function(t,e){r=e==s.length-1?""+r+t.position[0]+","+t.position[1]:""+r+t.position[0]+","+t.position[1]+";"}),a={name:this.formdata.name,points:r,enable:"true",valid_time:i,repeat:"Mon,Tues,Wed,Thur,Fri,Sat,Sun",time:"00:00,11:59;13:00,23:59",desc:"测试围栏描述",alert_condition:this.formdata.alert_condition}}this.$route.query.gid?(delete a.enable,this.$http.post("http://restapi.amap.com/v4/geofence/meta?key="+this.mapKey+"&gid="+this.$route.query.gid+"&method=patch",a).then(function(e){t.Indicator.close()}).catch(function(e){t.toast("更新围栏失败")})):this.$http.post("http://restapi.amap.com/v4/geofence/meta?key="+this.mapKey,a).then(function(e){"成功"==e.data.data.message?(t.toast("创建围栏成功"),setTimeout(function(){t.$router.replace({path:"/enclosure"})},1500)):t.Indicator.close()}).catch(function(e){t.Indicator.close(),t.toast("创建围栏失败")})}},subServer:function(t,e){var o=this;this.$route.query.gid?this.$http.post(this.HOST+"/post/editEnclosure",{id:this.$route.query.id,userToken:this.userInfo.userToken,student_id:this.userInfo.student_id,s_id:"0",g_id:this.$route.query.gid,name:t.name,desc:"",center:0==this.enclosureInfo.type?t.center:"",radius:0==this.enclosureInfo.type?t.radius:"",points:0==this.enclosureInfo.type?"":t.points,enable:!0,repeat:t.repeat,fixed_date:"",time:t.time,alert_condition:"enter"==t.alert_condition?"0":"1"}).then(function(t){"000000"==t.data.code&&(o.Indicator.close(),o.toast("更新围栏成功"),setTimeout(function(){o.$router.replace({path:"/enclosure"})},1500))}).catch(function(t){o.toast("保存失败")}):this.$http.post(this.HOST+"/post/addEnclosure",{userToken:this.userInfo.userToken,student_id:this.userInfo.student_id,s_id:e.id,g_id:e.gid,name:t.name,desc:"",center:0==this.enclosureInfo.type?t.center:"",radius:0==this.enclosureInfo.type?t.radius:"",points:0==this.enclosureInfo.type?"":t.points,enable:t.enable,valid_time:t.valid_time,repeat:t.repeat,fixed_date:"",time:t.time,alert_condition:"enter"==t.alert_condition?"0":"1"}).then(function(t){"000000"==t.data.code&&(o.Indicator.close(),o.toast("创建围栏成功"),setTimeout(function(){o.$router.replace({path:"/enclosure"})},1500))}).catch(function(t){o.toast("保存失败")})}}},r={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"info-body"},[o("mt-header",{attrs:{title:"电子围栏"}},[o("mt-button",{attrs:{slot:"left",icon:"back"},on:{click:t.goback},slot:"left"})],1),t._v(" "),o("mt-field",{attrs:{label:"围栏名称",placeholder:"填写围栏名称"},model:{value:t.formdata.name,callback:function(e){t.$set(t.formdata,"name",e)},expression:"formdata.name"}}),t._v(" "),o("mt-radio",{attrs:{align:"right",options:t.options},model:{value:t.formdata.alert_condition,callback:function(e){t.$set(t.formdata,"alert_condition",e)},expression:"formdata.alert_condition"}}),t._v(" "),o("div",{staticClass:"opreate"},[o("button",{staticClass:"btn-sub",on:{click:t.sub}},[t._v("确定")])])],1)},staticRenderFns:[]};var c=o("Z0/y")(s,r,!1,function(t){o("VsFl")},"data-v-e2c6eae8",null);e.default=c.exports}});
//# sourceMappingURL=2.616295aa7721ba28b7e3.js.map